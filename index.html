<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">

<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>CSV Converter</title>
  <meta name="author" content="Shan Carter">
  <!-- Date: 2010-08-26 -->
  <link rel="stylesheet" href="css/converter.css" type="text/css" media="screen" title="no title" charset="utf-8">

  <script src="js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/CSVParser.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/DataGridRenderer.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/converter.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/Controller.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/upload.js" type="text/javascript" charset="utf-8"></script>
  
  <script src="js/base64.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/underscore-min.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/github.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/utilities.js" type="text/javascript" charset="utf-8"></script>  

  <script type="text/javascript" charset="utf-8"> 
    
    function authenticated()
        {
        $oAuth_Token = getUrlVar('oAuth_Token'); 

        if($oAuth_Token!='')
            {
            document.getElementById('oAuth_Token').value = $oAuth_Token;    
            }  
        else
            {
            document.getElementById("save").style.display = 'none';
            }                       
        }
    
    function saveConversion()
        {
    
        var github = new Github({
            token: $oAuth_Token,
            auth: "oauth"
                });
                
        $UploadCSVName = "";
        $UploadJSONName = "";
        $UploadXMLName = "";
      
        $UploadFileName = document.getElementById("uploadfilename").value;
        $UploadCSVName = $UploadFileName;
        $DataSelector = document.getElementById("dataSelector").value;
        
        //alert($DataSelector);
        if($DataSelector=="xml") {
          $UploadXMLName = $UploadFileName.replace(".csv",".xml");  
        }
        
        if($DataSelector=="json") {
          $UploadJSONName = $UploadFileName.replace(".csv",".json");  
        }
        
        $CSVOutput = document.getElementById("dataInput").value;
        $DataOutput = document.getElementById("dataOutput").value;
      
        var repo = github.getRepo('department-of-veterans-affairs', 'csv-converter'); 
        repo.write('master',$UploadCSVName, $CSVOutput, 'Saving CSV Input for ' + $UploadCSVName, function(err) {
            
        }); 
        
        if($UploadJSONName!=''){
            alert($UploadJSONName + ' has been saved to master branch in this Github repo');
            repo.write('master',$UploadJSONName, $DataOutput, 'Saving JSON Input for ' + $UploadJSONName, function(err) {});
            }
        if($UploadXMLName!=''){
            alert($UploadXMLName + ' has been saved to master branch in this Github repo');
            repo.write('master',$UploadXMLName, $DataOutput, 'Saving XML Input for ' + $UploadXMLName, function(err) {});}
        }
        
    </script>     

</head>
<body onload="authenticated();">
  <div id='base'>
    <div id='header'>
      <div id="description">
        <h1>CSV Converter</h1>
        <p>This tool will convert your Excel data into JSON and XML.</p>
      </div>
      <div id='settings'>
        <h3>Settings</h3>
        <form id='settingsForm'>
           <p>Delimiter:

             <label><input class="settingsElement" type="radio" name="delimiter" id='delimiterAuto'   value="auto" checked/> Auto</label>
             <label><input class="settingsElement" type="radio" name="delimiter" id='delimiterComma'  value="comma" /> Comma</label>
             <label><input class="settingsElement" type="radio" name="delimiter" id='delimiterTab'    value="tab" /> Tab</label>
            </p>
          <p>Decimal Sign:

             <label><input class="settingsElement" type="radio" name="decimal" id='decimalDot'   value="dot" checked/> Dot</label>
             <label><input class="settingsElement" type="radio" name="decimal" id='decimalComma'  value="comma" /> Comma</label>
            </p>
          <p><label><input class="settingsElement" type="checkbox" name="" value="" id="headersProvidedCB" checked /> First row is the header</label></p>
          <div class="settingsGroup">
            <p>Transform: <label><input class="settingsElement" type="radio" name="headerModifications" value="downcase" id='headersDowncase' /> downcase</label>
            <label><input class="settingsElement" type="radio" name="headerModifications" id='headersUpcase' value="upcase" /> upcase</label>
            <label><input class="settingsElement" type="radio" name="headerModifications" id='headersNoTransform' value="none" checked /> none</label></p>
          </div>

          <p><label><input class="settingsElement" type="checkbox" name="some_name" value="" id="includeWhiteSpaceCB" checked /> Include white space in output</label></p>
          <div class="settingsGroup">
            <p>Indent with: <label><input class="settingsElement" type="radio" name="indentType" value="tabs" id='includeWhiteSpaceTabs'/> tabs</label> <label><input class="settingsElement" type="radio" name="indentType" value="spaces" id='includeWhiteSpaceSpaces' checked/> spaces</label></p>
          </div>
          <br />
          <p><label>Upload CSV:</label></p>
          <div class="settingsGroup">
            <input type="hidden" name="oAuth_Token" id="oAuth_Token" value="" />
            <input type="hidden" name="uploadfilename" id="uploadfilename" value="" />
            <p><input type="file" onchange="readfile(this.files[0])"></input></p>
          </div>     
          <br />  
          <div id="save" style="display: none;"> 
            <p align="center"><a href="#" onclick="saveConversion();">Save</a></p>
          </div>    
        </form>

      </div>
    </div>



    <div id='converter' class=''>

    </div>

  </div>


</body>
</html>
